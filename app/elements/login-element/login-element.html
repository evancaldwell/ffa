<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="login-element" attributes="">
  <template>
    <link rel="stylesheet" href="login-element.css">

    <!-- =========== non-display ========== -->
    <firebase-login 
        id="baseLogin" 
        user="{{user}}" 
        statusKnown="{{statusKnown}}" 
        location="https://ffapps.firebaseio.com/" 
        provider="github" 
        on-login="{{onLogin}}"
        on-error="{{onLoginError}}"></firebase-login>
    <firebase-element id="base" location="https://ffapps.firebaseio.com/" data="{{data}}" keys="{{keys}}"></firebase-element>
    <firebase-element id="users" location="https://ffapps.firebaseio.com/users/" data="{{users}}" keys="{{userKeys}}"></firebase-element>
    <pvc-globals values="{{globals}}"></pvc-globals>
    <!-- TODO: bring this back in when friend-list and app router are working
    <core-ajax
      auto
      url="http://graph.facebook.com/v2.2/me/picture?redirect=false&height=500&type=normal&width=500"
      handleAs="json"
      on-core-response="{{handleFBResponse}}"></core-ajax> -->

    <!-- =========== display ========== -->
    <paper-item on-click="{{login}}" hidden?="{{!statusKnown || user}}">Login</paper-item>
    <paper-item on-click="{{logout}}" hidden?="{{!statusKnown || !user}}">Logout</paper-item>

  </template>
  <script>
    (function () {
      'use strict';

      Polymer({
        // define element prototype here
        login: function() {
          this.$.baseLogin.login();
        },
        logout: function() {
          this.$.baseLogin.logout();
        },
        onLogin: function() {
          this.globals.currentUser = this.user;
          this.globals.fireKeys = this.keys;
          this.globals.fireData = this.data;
          console.log('user is: ' + JSON.stringify(this.globals.currentUser));
          console.log('data is: ' + JSON.stringify(this.globals.fireData));
        },
        onLoginError: function(err) {
          console.log('An error occurred: ' + JSON.stringify(err));
        },
        handleFBResponse: function(response) {
          console.log('FB response: ' + JSON.stringify(response));
        }
      });

    })();
  </script>
</polymer-element>
